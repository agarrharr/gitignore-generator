<html>
  <head>
    <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
  </head>
  <body>
    <label>What type of stuff do you want to ignore?</label>
    <input type="text" id="projectTypeInput"></input>
    <ul id="searchResults"></ul>
    <textarea id="results" cols="100" rows="20"></textarea>
    <script>
    var gitignoreTypes = [];
    var selectedTypes = [];

    $(document).ready(function() {
      getGitignoreFile();

      $('#projectTypeInput').keyup(function() {
        var value = $(this).val();
        makeGitignoreSearch(value);
      });
    });

    function getGitignoreFile() {
      $.get('https://api.github.com/repos/github/gitignore/contents/', function(d) {
        gitignoreTypes = convertToArrayOfGitignoreFiles(d);
      })
      .fail(function() {
        gitignoreTypes = ['Meteor', 'Ada'];
      });
    }

    function convertToArrayOfGitignoreFiles(d) {
      var gitignoreTypes = [];
      for(var i = 0; i < d.length; i += 1) {
        gitignoreTypes.push(d[i].name.split('.')[0]);
      }
      return gitignoreTypes;
    }

    function makeGitignoreSearch(searchTerm) {
      if (result = isValidType(searchTerm)) {
        showResults(result);
      }
    }

    function isValidType(type) {
      for(var i = 0; i < gitignoreTypes.length; i += 1) {
        if (gitignoreTypes[i].toLowerCase() === type.toLowerCase()) {
          return gitignoreTypes[i];
        }
      }
      return false;
    }

    function showResults(type) {
      var $input = $('<input type="checkbox" data-type="' + type + '" />');
      var $html = $('<li>' + type + '</li>');
      $html.prepend($input);
      $input.on('click', addContentToTextArea);
      $('#searchResults').html($html);
    }

    function addContentToTextArea(type) {
      var checked = $(this).prop('checked');
      var type = $(this).data('type');
      if (checked) {
        $.get('https://api.github.com/repos/github/gitignore/contents/' + type + '.gitignore', function(d) {
          var content = atob(d.content);
          selectedTypes.push({name: type, content: d.content});
          updateTextArea();
        })
        .fail(function() {
          selectedTypes.push({name: type, content: 'example code\nyeah'});
          updateTextArea();
        });
      } else {
        for(var i = 0; i < selectedTypes.length; i += 1) {
          if (type.toLowerCase() === selectedTypes[i].name.toLowerCase()) {
            selectedTypes.splice(i, 1);
            updateTextArea();
            break;
          }
        }
      }
    }

    function updateTextArea() {
      var totalContent = '';
      for(var i = 0; i < selectedTypes.length; i += 1) {
        if (i > 0) {
          totalContent += '\n\n';
        }
        totalContent += '# ' + selectedTypes[i].name + '\n';
        totalContent += selectedTypes[i].content;
      }

      $('#results').val(totalContent);
    }
    </script>
  </body>
</html>
